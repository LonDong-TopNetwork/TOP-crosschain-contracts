const { expect } = require("chai");
const { call } = require('./helpers/call')
const hardhat = require('hardhat')
const { deployContract } = require('ethereum-waffle')
const { deployMockContract } = require('./helpers/deployMockContract')
const { AddressZero } = require("ethers").constants

const toWei = ethers.utils.parseEther

const overrides = { gasLimit: 9500000 }

describe('TopProver', () => {

  let wallet, wallet2,wallet3
  let topProver
  let topBridge

  beforeEach(async () => {
    [wallet, wallet2,wallet3] = await hardhat.ethers.getSigners()
    provider = hardhat.ethers.provider

    console.log("wallet>>>> "  + wallet.address)

    const TopBridge =  await hre.ethers.getContractFactory("TopPridgeTest", wallet, overrides)
    topBridge = await TopBridge.deploy()
    
    const TopProver =  await hre.ethers.getContractFactory("TopProverTest", wallet, overrides)
    topProver = await TopProver.deploy(topBridge.address)

  })

  describe('verifyHash', () => {
    it('There is no hash', async () => {
        await expect(topProver.verifyHash('0x0000000000000000000000000000000000000000000000000000000000000001')
        ).to.be.revertedWith('fail to decode')
    })

    it('There is hash', async () => {
      await topBridge.setBlockHashes('0x0000000000000000000000000000000000000000000000000000000000000001',true)
      let{valid,reason} = await topProver.verifyHash('0x0000000000000000000000000000000000000000000000000000000000000001');
    })

  })

  describe('getAddLightClientTime', () => {
    it('There is no height', async () => {
        await expect(topProver.getAddLightClientTime(2)
        ).to.be.revertedWith('Height is not confirmed1')
    })

    it('There is height', async () => {
      await topBridge.setBlockHeights(2,100)
      expect(await call(topProver,"getAddLightClientTime",2)).to.equal(100)
    })

  })

  describe('verify', () => {
    it('There is verify', async () => {
        // await topProver.decode1('0x00000000000000009d000000f89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e041d01000000000000ac01000002f901a801840147737fb9010000000000000010000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000800080000000000200000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000002000000000000000000000080000000000000000000000002000000000000000000000f89df89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e041a020000f90217a032fa93ded4b451843d7cdd82f244742b695d30a05b1a500d1a15559ee9796c4ea01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794646db8ffc21e7ddc2b6327448dd9fa560df41087a0518bd0fbebab97165cb0721462ca91e90ca9fa9f88c9a11639a05e4cd431d058a0c022836baf12f53cb7e666795e32888b520431b351a01686fd53080c2c9145aca0f63ff69db73949c59e4999dc458fc5cfb775d85d2b04f323a905590cb15dbb53b90100bcfaf3b6f95a7ba73f768477ea5c7fe57f1ddb67b804e3b775df72fe9556b75bb5daddf6dddd0bfd2665df5945db697f3ffd9fed8b9b3bb5fb75eef30fbab8f3d4fac78fcf27eeff7d3f9f6bddaee260cef7d8a5dbfff74677673def8ae9dfbbffefc836f7d287ee8fed10a18c9f0cd1732f3eb7b35d8ddb6704dfb7b3ecff295fbd7f3c862ab9ddd76d8cffe58f02b64752bdfb5bd462dbbe2085f4f8b5f737bfbc235b77cd77ef96f6c3e38c78aff2d1938ac4b4b6bc2af9bfdf77565fb8f5cd585ffa43dfcfd74e50dfdfd937e3f645c43b79d3ac5ef34a647bfe9ff2664db1feffc91935e7bdaa8778f39c256ffa273b3db9ee790df750bfbad2e2f59caf872fb4074b2dc3ad83e4c69e8401c9c32a8401c9ae698462af9bc3944d696e656420427920416e74506f6f6c20303031a0e295e6923eee011c8996312185982aa753332264e7d71195f33c06ae9ca8d8f9886bb01f9aecf587cb0600000034010000f90131a0fa666de074e61f0a8606884c5ad540cd8aef16751659fe0531485292d2c5f24fa04db64b5cbcd052f57eb630fb53352332c132d107b4027b11540aee990e8c0028a058a689b484a8e6d4715142c2e8915df28253c2be0cda9bff49214b5d562e50f9a08a297582c3244c30911bea912bd2897f343dc928517d7090eeb4e6415722bdc0a08dd146c10f9265ed8881f91279f85b74affdad555aad810d40499a0e5db177b0a0a2027199819afa25c8cc07270ae5dcb090e7a104b80d28f2a928ff1d03042fc2a0140d7ac3e79cfa6aefa1433e53d4005b7acf23e473a963f93e7f9a503a11710da0775da2aee94710aa881094c1bac0af5efbb770fc31011a56b4116dc6b68e4a71a0ee561d0d78e9879474e724f3f191583fd3c9f8af5fd331e5b19ee4a0dea22eb8808080808080808073000000f871a0028bee0aa4c6af6c2bd3a8f0cad8ce62b7b4b3f58145dfeed7b36b82c68ca94aa0373820e1020ec76587efa9f596fccadc36892a71c392c144c14cfb121c65a372a0f5ea148725e9ca6896978ce6493c7ef7adffda9dbc8e81caef42acca1e77d883808080808080808080808080808025000000e4820001a02c3ac950e1399c1b87c22052247b02d433cbb789ce6f41e664cd1dd36864723e54010000f90151a0d9d09972f3ed377e6f90082b93b77fe7aedf9578ae0aaf9242f1b152d9eef439a05d1e66cee780e13f0949841a789d5ece3dd0d5aa473553722755da84f4c330b3a074e4ee1a9bb09b292fc5849a4c0105b8ffddff6651d2d38b3c8fbd85b06e4146a04544cb103b3db14a7fd90a7d813023263b2c5a22b5afab69d285af32d2d70280a040c3d7a9c6de2009ad33e7209465770b418873049d4277d82b4cff5c18a0f72ca09b5cd29c54c284431e51bf48144e9bf533384f718e501f57aab8eec9eb8f4a48a0c5cdba2af4ebb36ca089902e262458f5ef4eee5bc0a5901eea0630828d7682aaa0b5cd4b0aa12cb1361da62ff94bde7dc62a9c05177d24e47307e3d24e87e48021a0c2836786977367e06e9a2ebc7aa0a07cb013daec771224f1be976bdd5c5eab36a05d7b51128ae9ed10ebde0b9df342eb91d0bcca82aa08acef03b77a414e842d078080808080808014020000f90211a0e3dd21e44cadc5387cba13e2d8dc4380fda3cdd4b8adb8c5f7c9a2115c122701a014c17e43076db294f5159b8cecccc3841b438fbf62b3ee1b2c52cff562a8af54a08be246de5bcb9ce5b46acd13d64d19c16d96ca3192aa864a0f40676ccbb9608ca0eb4c3f961ced94aac4042c6a8b51d34b4d5ffec81bf8e587cbaece536e313a82a09fa3b2ff7e47b4e59208a483a2fc0952ebc3108c8c09ae9864f24c7a29670d21a0bab72f2988a59d537f472bc40225649490dd8d056bcce92c84ccb8cb48e62ff2a045684910695aeb9dd84f1730544a3de63d4074d3b88ce8c8b7c67f2eb7fecb6fa0ffc67e5fd101173b8e393134254b407ab307d2277c392a8d7e01d617bc80c20ea06d4388b543ccb169fc72b0ed15adc5b0e986c84859d79dccf96fc6d37438c814a038fe446a4cabf700c1c46ef1cac457749ba3f02732578a569e5fba81f8a9c656a0df26e3c163bbeb392faadfa70ce6cbf2457a1e53621819e6d1188ebead477c49a0ff4c1b71ca8a9a58eb11ecb838e39adff9bee887a5ccbcecbc50e5a73a9d4469a0be5dbede4c94564206f7f29f1e2e5a475acc28681530af7aa8b5ced28c1952dba061643dce0dc8df1c348a055b5438336129d61cb94cc627994724548d377627b6a08117bc034cc09ae07caf3792ea0a12c8ecdb878a06ab6ad9d36865cbf6da4bc0a036bf16c4658a9b282f30276a81133958cb7893c98575ca3677040d402e74fb6680b3010000f901b020b901ac02f901a801840147737fb9010000000000000010000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000800080000000000200000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000002000000000000000000000080000000000000000000000002000000000000000000000f89df89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e04')
        let data = await topProver.decode2('0x02000000000000001f010000f9011c9488e6a0c2ddd26feeb64f039a2c41296fcb3f5640f863a0c42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638b8a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffd7ccde5107000000000000000000000000000000000000000000000008210e1d53794c80000000000000000000000000000000000000007321272ebe623701abfe772fb4ee00000000000000000000000000000000000000000000000069b1648cadfddfe4000000000000000000000000000000000000000000000000000000000003240a00000000000000006803000002f90364018301e39db9010000000000010000000000000000000000000000000000000000000000040000000000000000000000000008000000000002000000080020000000000000000000000000000000000808000008000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000010000800000000000000000000000000000001000000000000010000000000000000000000000000000000200000000000000000000000000000000000002000000008000000000002000000000200000000000000000000000000000000000000000000000000200000000000000010000000000000000000000000000000000000000000f90259f89b94a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a0000000000000000000000000000000000000000000000000000000283321aef9f89b94c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640a0000000000000000000000000000000000000000000000008210e1d53794c8000f9011c9488e6a0c2ddd26feeb64f039a2c41296fcb3f5640f863a0c42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638b8a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffd7ccde5107000000000000000000000000000000000000000000000008210e1d53794c80000000000000000000000000000000000000007321272ebe623701abfe772fb4ee00000000000000000000000000000000000000000000000069b1648cadfddfe4000000000000000000000000000000000000000000000000000000000003240a18020000f90215a0ab40847b2a34d9dad2c7c96ad1a75830792e606e58171ee80017d3e67faf0630a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794ea674fdde714fd979de3edf0f56aa9716b898ec8a0270af15327c38e1ba8a51858483df53662600fed8df8c495ebec37b5650e689da075114598ffe898ffab3be7bb69c42c946fd6a5d5bdfb99dea625a5ce038772a2a0137a525f82549a2ee4acb6371e5f2cd9387b427161ec59622b21a2dd9472c9c2b901006db2439523e313893ef86898ea31df6dd3f63297051583b0fa3bcf6ac6cfef2d9d2c58437969ab8d00cae96b5d6e5fc38f239d9a0bc2e6d09f45efff7764bc5869e63f9b510f5c3dfe583739e322e3a8fbd08926cb44c6c9bfcadeb3ea9a75639ac35fa1cfef9d9d9d5253cc3e74dff36aed3ec7c47d1dc74515ee3ea94d5d2e4e31918c9b8bb5d7ec4dad58612b70656a57f7b9b752a4182a7cb55daa747d74ff63ad7f5cb3eb87f9e1d7cb25dfd9c41fe5a3b614f9bbdac67febebbbe9caddcde5e497b7cdd8731faaeaff6b7e72fce279c0f4ff6c3a7e40abfd8e657d7aef90726b783c2ec767e744b4b7ef079e8b10257892f5ca3f7af33defcd3eab63ef8732aee3ccf8fce683e520518401caa87b8401626f0d8462b51e508c617369612d65617374322d39a03b837a782dead35c69e5977f24240897b2f04906675a838fdb850efcd7a86ea7883cd3b021cabd9beb8506b9afdbb70300000034010000f90131a0ff2adcce65829875641f6179f254d35d52c800459e2d191d2bb56a7f4ff6b6ada02499e10dc5fff323facac0ce3e741707439f75172906c5ede54c11110fdb44aaa08636595c5e1509df15eff6e0cf799679330b3346ab5e33bb994c540416e08e6ba055b3b05861a6e8788ae8bb4a00cc22a734b731eaa8ddbf6be2326125744621b3a01db781e83e979d3fc3ddfb74ea1ca0904fa97a86a8d371d34dad33fb0b9a459ca008e2db1a845669e5940d2ae926ac6fe25d1844bbe742c8407e0b5e36a8ffc738a06af877698d94ac7048785d9ee8124cfe9381d67d0a9b84416652d737051a373ba0fb37f402e0987875716e4c8fa9e8b26ee76fdbf009ea8e2b63a9b01b520efa85a0c8564fbf58f08eb32baed345f343bd65a28d7b9a959d6786eccd41fec028a7eb808080808080808073000000f871a0a5fe44b8dd34bc4c44735af1d724605ba855ad5653bd43145142734cf0ba6689a04d9fff04dfcf860898047e7b8191e0c23837cfc542a4f1d966e988e99e6ccde7a0276a7a174345302d173b02c8ddceca2160bebf9da1fdd50347c0ad1eac63fd2a80808080808080808080808080806f030000f9036c20b9036802f90364018301e39db9010000000000010000000000000000000000000000000000000000000000040000000000000000000000000008000000000002000000080020000000000000000000000000000000000808000008000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000010000800000000000000000000000000000001000000000000010000000000000000000000000000000000200000000000000000000000000000000000002000000008000000000002000000000200000000000000000000000000000000000000000000000000200000000000000010000000000000000000000000000000000000000000f90259f89b94a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a0000000000000000000000000000000000000000000000000000000283321aef9f89b94c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f5640a0000000000000000000000000000000000000000000000008210e1d53794c8000f9011c9488e6a0c2ddd26feeb64f039a2c41296fcb3f5640f863a0c42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638a0000000000000000000000000beefbabeea323f07c59926295205d3b7a17e8638b8a0ffffffffffffffffffffffffffffffffffffffffffffffffffffffd7ccde5107000000000000000000000000000000000000000000000008210e1d53794c80000000000000000000000000000000000000007321272ebe623701abfe772fb4ee00000000000000000000000000000000000000000000000069b1648cadfddfe4000000000000000000000000000000000000000000000000000000000003240a')
        console.log(JSON.stringify(data))

    })
  })

})
