const { expect } = require("chai");
const { call } = require('./helpers/call')
const hardhat = require('hardhat')
const { deployContract } = require('ethereum-waffle')
const { deployMockContract } = require('./helpers/deployMockContract')
const { AddressZero } = require("ethers").constants

const toWei = ethers.utils.parseEther

const overrides = { gasLimit: 9500000 }

describe('TopProver', () => {

  let wallet, wallet2,wallet3
  let topProver
  let topBridge

  beforeEach(async () => {
    [wallet, wallet2,wallet3] = await hardhat.ethers.getSigners()
    provider = hardhat.ethers.provider

    console.log("wallet>>>> "  + wallet.address)

    const TopBridge =  await hre.ethers.getContractFactory("TopPridgeTest", wallet, overrides)
    topBridge = await TopBridge.deploy()
    
    const TopProver =  await hre.ethers.getContractFactory("TopProverTest", wallet, overrides)
    topProver = await TopProver.deploy(topBridge.address)

  })

  describe('verifyHash', () => {
    it('There is no hash', async () => {
        await expect(topProver.verifyHash('0x0000000000000000000000000000000000000000000000000000000000000001')
        ).to.be.revertedWith('fail to decode')
    })

    it('There is hash', async () => {
      await topBridge.setBlockHashes('0x0000000000000000000000000000000000000000000000000000000000000001',true)
      let{valid,reason} = await topProver.verifyHash('0x0000000000000000000000000000000000000000000000000000000000000001');
    })

  })

  describe('getAddLightClientTime', () => {
    it('There is no height', async () => {
        await expect(topProver.getAddLightClientTime(2)
        ).to.be.revertedWith('Height is not confirmed1')
    })

    it('There is height', async () => {
      await topBridge.setBlockHeights(2,100)
      expect(await call(topProver,"getAddLightClientTime",2)).to.equal(100)
    })

  })

  describe('verify', () => {
    it('There is verify', async () => {
        // await topProver.decode1('0x00000000000000009d000000f89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e041d01000000000000ac01000002f901a801840147737fb9010000000000000010000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000800080000000000200000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000002000000000000000000000080000000000000000000000002000000000000000000000f89df89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e041a020000f90217a032fa93ded4b451843d7cdd82f244742b695d30a05b1a500d1a15559ee9796c4ea01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794646db8ffc21e7ddc2b6327448dd9fa560df41087a0518bd0fbebab97165cb0721462ca91e90ca9fa9f88c9a11639a05e4cd431d058a0c022836baf12f53cb7e666795e32888b520431b351a01686fd53080c2c9145aca0f63ff69db73949c59e4999dc458fc5cfb775d85d2b04f323a905590cb15dbb53b90100bcfaf3b6f95a7ba73f768477ea5c7fe57f1ddb67b804e3b775df72fe9556b75bb5daddf6dddd0bfd2665df5945db697f3ffd9fed8b9b3bb5fb75eef30fbab8f3d4fac78fcf27eeff7d3f9f6bddaee260cef7d8a5dbfff74677673def8ae9dfbbffefc836f7d287ee8fed10a18c9f0cd1732f3eb7b35d8ddb6704dfb7b3ecff295fbd7f3c862ab9ddd76d8cffe58f02b64752bdfb5bd462dbbe2085f4f8b5f737bfbc235b77cd77ef96f6c3e38c78aff2d1938ac4b4b6bc2af9bfdf77565fb8f5cd585ffa43dfcfd74e50dfdfd937e3f645c43b79d3ac5ef34a647bfe9ff2664db1feffc91935e7bdaa8778f39c256ffa273b3db9ee790df750bfbad2e2f59caf872fb4074b2dc3ad83e4c69e8401c9c32a8401c9ae698462af9bc3944d696e656420427920416e74506f6f6c20303031a0e295e6923eee011c8996312185982aa753332264e7d71195f33c06ae9ca8d8f9886bb01f9aecf587cb0600000034010000f90131a0fa666de074e61f0a8606884c5ad540cd8aef16751659fe0531485292d2c5f24fa04db64b5cbcd052f57eb630fb53352332c132d107b4027b11540aee990e8c0028a058a689b484a8e6d4715142c2e8915df28253c2be0cda9bff49214b5d562e50f9a08a297582c3244c30911bea912bd2897f343dc928517d7090eeb4e6415722bdc0a08dd146c10f9265ed8881f91279f85b74affdad555aad810d40499a0e5db177b0a0a2027199819afa25c8cc07270ae5dcb090e7a104b80d28f2a928ff1d03042fc2a0140d7ac3e79cfa6aefa1433e53d4005b7acf23e473a963f93e7f9a503a11710da0775da2aee94710aa881094c1bac0af5efbb770fc31011a56b4116dc6b68e4a71a0ee561d0d78e9879474e724f3f191583fd3c9f8af5fd331e5b19ee4a0dea22eb8808080808080808073000000f871a0028bee0aa4c6af6c2bd3a8f0cad8ce62b7b4b3f58145dfeed7b36b82c68ca94aa0373820e1020ec76587efa9f596fccadc36892a71c392c144c14cfb121c65a372a0f5ea148725e9ca6896978ce6493c7ef7adffda9dbc8e81caef42acca1e77d883808080808080808080808080808025000000e4820001a02c3ac950e1399c1b87c22052247b02d433cbb789ce6f41e664cd1dd36864723e54010000f90151a0d9d09972f3ed377e6f90082b93b77fe7aedf9578ae0aaf9242f1b152d9eef439a05d1e66cee780e13f0949841a789d5ece3dd0d5aa473553722755da84f4c330b3a074e4ee1a9bb09b292fc5849a4c0105b8ffddff6651d2d38b3c8fbd85b06e4146a04544cb103b3db14a7fd90a7d813023263b2c5a22b5afab69d285af32d2d70280a040c3d7a9c6de2009ad33e7209465770b418873049d4277d82b4cff5c18a0f72ca09b5cd29c54c284431e51bf48144e9bf533384f718e501f57aab8eec9eb8f4a48a0c5cdba2af4ebb36ca089902e262458f5ef4eee5bc0a5901eea0630828d7682aaa0b5cd4b0aa12cb1361da62ff94bde7dc62a9c05177d24e47307e3d24e87e48021a0c2836786977367e06e9a2ebc7aa0a07cb013daec771224f1be976bdd5c5eab36a05d7b51128ae9ed10ebde0b9df342eb91d0bcca82aa08acef03b77a414e842d078080808080808014020000f90211a0e3dd21e44cadc5387cba13e2d8dc4380fda3cdd4b8adb8c5f7c9a2115c122701a014c17e43076db294f5159b8cecccc3841b438fbf62b3ee1b2c52cff562a8af54a08be246de5bcb9ce5b46acd13d64d19c16d96ca3192aa864a0f40676ccbb9608ca0eb4c3f961ced94aac4042c6a8b51d34b4d5ffec81bf8e587cbaece536e313a82a09fa3b2ff7e47b4e59208a483a2fc0952ebc3108c8c09ae9864f24c7a29670d21a0bab72f2988a59d537f472bc40225649490dd8d056bcce92c84ccb8cb48e62ff2a045684910695aeb9dd84f1730544a3de63d4074d3b88ce8c8b7c67f2eb7fecb6fa0ffc67e5fd101173b8e393134254b407ab307d2277c392a8d7e01d617bc80c20ea06d4388b543ccb169fc72b0ed15adc5b0e986c84859d79dccf96fc6d37438c814a038fe446a4cabf700c1c46ef1cac457749ba3f02732578a569e5fba81f8a9c656a0df26e3c163bbeb392faadfa70ce6cbf2457a1e53621819e6d1188ebead477c49a0ff4c1b71ca8a9a58eb11ecb838e39adff9bee887a5ccbcecbc50e5a73a9d4469a0be5dbede4c94564206f7f29f1e2e5a475acc28681530af7aa8b5ced28c1952dba061643dce0dc8df1c348a055b5438336129d61cb94cc627994724548d377627b6a08117bc034cc09ae07caf3792ea0a12c8ecdb878a06ab6ad9d36865cbf6da4bc0a036bf16c4658a9b282f30276a81133958cb7893c98575ca3677040d402e74fb6680b3010000f901b020b901ac02f901a801840147737fb9010000000000000010000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000800080000000000200000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000002000000000000000000000080000000000000000000000002000000000000000000000f89df89b94b8c77482e45f1f44de1745f52c74426c631bdd52f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000f2d509a34638a0bdbfaa8fd798492b9592398bfea000000000000000000000000039f984d2f609044e445ab3cafdb19626973b35c0a0000000000000000000000000000000000000000000000000003afe7850d31e04')
        let data = await topProver.decode2('0x0300000000000000fe000000f8fc9492cc4300b9fd36242900bca782b2e9e000bd5099f863a0d78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822a00000000000000000000000001111111254fb6c44bac0bed2854e76f90643097da00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fb880000000000000000000000000000000000000000000000039dc643b82b352f8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014638025e76c26100200000000000000c1030000f903be0183056599b9010000200000000000000800000080000400000000000000000000000000000000000000000000000000040000000000000002000000080000000000000000000000000000000000000000000008000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000010000001000000000004000000000100001000000090000004000000000000000000000000000000000000000000000000000000000000000000000000001000002000000000000000000000000000000000100001200000000000000000000200000008000000000000000000002000000000000000000000000100000f902b3f89b9416eccfdbb4ee1a85a33f3a9b21175cd7ae753db4f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fa000000000000000000000000092cc4300b9fd36242900bca782b2e9e000bd5099a0000000000000000000000000000000000000000000000039dc643b82b352f800f89b94c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000092cc4300b9fd36242900bca782b2e9e000bd5099a00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fa000000000000000000000000000000000000000000000000014638025e76c2610f8799492cc4300b9fd36242900bca782b2e9e000bd5099e1a01c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1b8400000000000000000000000000000000000000000000009d74de6a3547ecf8d6700000000000000000000000000000000000000000000000365f55686f993f5fdf8fc9492cc4300b9fd36242900bca782b2e9e000bd5099f863a0d78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822a00000000000000000000000001111111254fb6c44bac0bed2854e76f90643097da00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fb880000000000000000000000000000000000000000000000039dc643b82b352f8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014638025e76c261020020000f9021da032fa93ded4b451843d7cdd82f244742b695d30a05b1a500d1a15559ee9796c4ea01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794646db8ffc21e7ddc2b6327448dd9fa560df41087a0518bd0fbebab97165cb0721462ca91e90ca9fa9f88c9a11639a05e4cd431d058a0c022836baf12f53cb7e666795e32888b520431b351a01686fd53080c2c9145aca0f63ff69db73949c59e4999dc458fc5cfb775d85d2b04f323a905590cb15dbb53b90100bcfaf3b6f95a7ba73f768477ea5c7fe57f1ddb67b804e3b775df72fe9556b75bb5daddf6dddd0bfd2665df5945db697f3ffd9fed8b9b3bb5fb75eef30fbab8f3d4fac78fcf27eeff7d3f9f6bddaee260cef7d8a5dbfff74677673def8ae9dfbbffefc836f7d287ee8fed10a18c9f0cd1732f3eb7b35d8ddb6704dfb7b3ecff295fbd7f3c862ab9ddd76d8cffe58f02b64752bdfb5bd462dbbe2085f4f8b5f737bfbc235b77cd77ef96f6c3e38c78aff2d1938ac4b4b6bc2af9bfdf77565fb8f5cd585ffa43dfcfd74e50dfdfd937e3f645c43b79d3ac5ef34a647bfe9ff2664db1feffc91935e7bdaa8778f39c256ffa273b3db9ee790df750bfbad2e2f59caf872fb4074b2dc3ad83e4c69e8401c9c32a8401c9ae698462af9bc3944d696e656420427920416e74506f6f6c20303031a0e295e6923eee011c8996312185982aa753332264e7d71195f33c06ae9ca8d8f9886bb01f9aecf587cb850b2eb622290300000034010000f90131a0fa666de074e61f0a8606884c5ad540cd8aef16751659fe0531485292d2c5f24fa04db64b5cbcd052f57eb630fb53352332c132d107b4027b11540aee990e8c0028a058a689b484a8e6d4715142c2e8915df28253c2be0cda9bff49214b5d562e50f9a08a297582c3244c30911bea912bd2897f343dc928517d7090eeb4e6415722bdc0a08dd146c10f9265ed8881f91279f85b74affdad555aad810d40499a0e5db177b0a0a2027199819afa25c8cc07270ae5dcb090e7a104b80d28f2a928ff1d03042fc2a0140d7ac3e79cfa6aefa1433e53d4005b7acf23e473a963f93e7f9a503a11710da0775da2aee94710aa881094c1bac0af5efbb770fc31011a56b4116dc6b68e4a71a0ee561d0d78e9879474e724f3f191583fd3c9f8af5fd331e5b19ee4a0dea22eb88080808080808080f4010000f901f180a0a7487ba6ab9ba3b805f2f6f460bd594646417dd8fda48970b911dc896e157933a03f3eceda264f00855c9da02876fba5a778e36e24cdf318200f1bcdac4e4f8096a0a43eca2624de5ebcfffb153b1da60f2e6d19fe71319b4ea78502d7f02c331b9ca0b0f37af87be2d69cb765733da34f092221452d5ddc7f5ee7dd02255d548d8e45a00730cf0dd6296ec44032395062dc3e6363279b971eb43bbacd9ab0109e26ac28a04e99f5da9c7a9c82bc7939b24d334ea9a962bd2875bc8774bf6bdfff4171e494a0a8bd0db5e3fcc96752011390734c67aa990b3576085e11d93046ae97ae58e929a086450d46fec597a5a69ee0ddd308df3a8e253a7e3594af83bff21bbc786a54fea0f0c65a6cd4828e6b49a70fc284eccf0ddb68ca4ed8ea7f7512174fbd572ca192a083d83be2fee8ab54063743c9be008f0d90e5e8f9ac6ba74a0022d50d624bd619a01831beb97d02c99d6317b99ccfa9817ac227d373f14df1843e0b4c1f7f43a8eda0319aec891a9373420986944082f4f31df11916cce394d88595bcabe814d4dc91a0188329f81a2aafe768539fa466f55d2d686b0907692b065f57ad00c259a7661fa0a9ff5aabcd3ec5b98ab47dc1b77d3c5e264b4c95f2c7e54148ba7554a516dfe6a0eef9bbe3f91bcb8991456a2fccbf1ba3627212bc1a4f843a3c88668f4ad1901f80c8030000f903c520b903c1f903be0183056599b9010000200000000000000800000080000400000000000000000000000000000000000000000000000000040000000000000002000000080000000000000000000000000000000000000000000008000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000010000001000000000004000000000100001000000090000004000000000000000000000000000000000000000000000000000000000000000000000000001000002000000000000000000000000000000000100001200000000000000000000200000008000000000000000000002000000000000000000000000100000f902b3f89b9416eccfdbb4ee1a85a33f3a9b21175cd7ae753db4f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fa000000000000000000000000092cc4300b9fd36242900bca782b2e9e000bd5099a0000000000000000000000000000000000000000000000039dc643b82b352f800f89b94c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2f863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa000000000000000000000000092cc4300b9fd36242900bca782b2e9e000bd5099a00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fa000000000000000000000000000000000000000000000000014638025e76c2610f8799492cc4300b9fd36242900bca782b2e9e000bd5099e1a01c411e9a96e071241c2f21f7726b17ae89e3cab4c78be50e062b03a9fffbbad1b8400000000000000000000000000000000000000000000009d74de6a3547ecf8d6700000000000000000000000000000000000000000000000365f55686f993f5fdf8fc9492cc4300b9fd36242900bca782b2e9e000bd5099f863a0d78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822a00000000000000000000000001111111254fb6c44bac0bed2854e76f90643097da00000000000000000000000006cbd3a415a440ee6514f0bc1e0bf22871343441fb880000000000000000000000000000000000000000000000039dc643b82b352f8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014638025e76c2610')
        console.log(JSON.stringify(data))

    })
  })

})
